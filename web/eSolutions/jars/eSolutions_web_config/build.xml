<?xml version="1.0" encoding="UTF-8"?>
<project name="eSolutions_web_config" default="build" basedir=".">
    <description>eSolutions_web_config buildfile</description>

    <property environment="env" />
    <property file="buildProps/build.properties" />

    <condition property="is_windows">
        <os family="windows" />
    </condition>
    <condition property="is_unix">
        <os family="unix" />
    </condition>

    <target name="setWindows" if="is_windows">
        <property name="antContribPath" value="C:/xampp/ant/lib/ant-contrib.jar" />
    </target>

    <target name="setUnix" if="is_unix">
        <property name="antContribPath" value="/opt/Apache/ant/current/lib/ant-contrib.jar" />
    </target>

    <taskdef resource="net/sf/antcontrib/antlib.xml">
        <classpath>
            <pathelement location="${antContribPath}" />
        </classpath>
    </taskdef>

    <target name="build" depends="setWindows, setUnix">
        <copy file="${basedir}/src/main/resources/SecurityService/config/ServiceConfig.xml" tofile="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositoryHost@" value="${repositoryHost}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositoryPort@" value="${repositoryPort}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositoryUser@" value="${repositoryUser}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositoryPass@" value="${repositoryPass}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositorySalt@" value="${repositorySalt}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@baseObjectClass@" value="${baseObjectClass}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositoryBaseDN@" value="${repositoryBaseDN}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositoryUserBase@" value="${repositoryUserBase}" />
        <replace file="${basedir}/target/classes/SecurityService/config/ServiceConfig.xml" token="@repositoryAppBase@" value="${repositoryAppBase}" />

        <tstamp>
            <format property="TODAY" pattern="yyyy-MM-dd HH:mm:ss" />
        </tstamp>

        <exec executable="git" outputproperty="git.revision" failifexecutionfails="false" errorproperty="">
            <arg value="describe"/>
            <arg value="--tags"/>
            <arg value="--always"/>
            <arg value="HEAD"/>
        </exec>

        <touch file="${buildArea}/${projectName}-${projectVersion}.version" />

        <echo message="${projectName} commit version ${git.revision} built ${TODAY}" output="${buildArea}/${projectName}-${projectVersion}.version" append="false" />
    </target>
</project>
